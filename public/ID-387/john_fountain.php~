<?php

function calculateBMI($height, $weight)
{
    $height = explode('-', $height);
    $heightInches = (int)$height[0] * 12 + (int)$height[1];
    $BMI = (int)$weight / ($heightInches * $heightInches) * 703;
        return $BMI;
}

if ($argv[1] != "")
        $leadid = $argv[1];
else
        $leadid = $_POST["leadid"];



$pingPost = new PingPostCommon();
$lmsData = $pingPost->fetchLead($leadid, 'lifeins_lead');
if (empty($lmsData)) {
    echo "Result=NotSold - Empty result found for lead id: " . $leadid;
    exit;
}

$postStringVals = json_decode($lmsData['poststring'], true);
$vals = array_merge($lmsData,$postStringVals, $_POST);
extract($vals);


//$coverage = array('06390','00544','00501','11757','11755','11754','11764','11763','11760','11752','11746','11743','11742','11751','11749','11747','11766','11779','11778','11777','11784','11782','11780','11776','11769','11768','11767','11775','11772','11770','11741','11716','11715','11713','11719','11718','11717','11707','11703','11702','11701','11706','11705','11704','11720','11733','11731','11730','11740','11739','11738','11729','11724','11722','11721','11727','11726','11725','11948','11947','11969','11949','11967','11968','11950','11971','11972','11973','11942','11946','11970','11944','11965','11955','11956','11957','11954','11953','11952','11951','11962','11963','11964','11961','11958','11959','11960','11975','11798','11796','11795','11901','11932','11931','11930','11788','11787','11786','11789','11794','11792','11790','11940','11939','11977','11980','11941','11978','11933','11976','11934','11937','11935');
$stringCoverage = '90001,90002,90003,90004,90005,90006,90007,90008,90009,90010,90011,90012,90013,90014,90015,90016,90017,90018,90019,90020,90021,90022,90023,90024,
		   90025,90026,90027,90028,90029,90030,90031,90032,90033,90034,90035,90036,90037,90038,90039,90040,90041,90042,90043,90044,90045,90046,90047,90048,
		   90049,90050,90051,90052,90053,90054,90055,90056,90057,90058,90059,90060,90061,90062,90063,90064,90065,90066,90067,90068,90069,90070,90071,90072,
		   90073,90074,90075,90076,90077,90078,90079,90080,90081,90082,90083,90084,90086,90087,90088,90089,90091,90093,90094,90095,90096,90097,90099,90101,
		   90102,90103,90174,90185,90201,90202,90209,90210,90211,90212,90213,90220,90221,90222,90223,90224,90230,90231,90232,90233,90239,90240,90241,90242,
		   90245,90247,90248,90249,90250,90251,90254,90255,90260,90261,90262,90263,90264,90265,90266,90267,90270,90272,90274,90275,90277,90278,90280,90290,
		   90291,90292,90293,90294,90295,90296,90301,90302,90303,90304,90305,90306,90307,90308,90309,90310,90311,90312,90313,90397,90398,90401,90402,90403,
		   90404,90405,90406,90407,90408,90409,90410,90411,90501,90502,90503,90504,90505,90506,90507,90508,90509,90510,90601,90602,90603,90604,90605,90606,
		   90607,90608,90609,90610,90612,90620,90621,90622,90623,90624,90630,90631,90632,90633,90637,90638,90639,90640,90650,90651,90652,90659,90660,90661,
		   90662,90665,90670,90671,90680,90701,90702,90703,90704,90706,90707,90710,90711,90712,90713,90714,90715,90716,90717,90720,90721,90723,90731,90732,
		   90733,90734,90740,90742,90743,90744,90745,90746,90747,90748,90749,90801,90802,90803,90804,90805,90806,90807,90808,90809,90810,90813,90814,90815,
		   90822,90831,90832,90833,90834,90835,90840,90842,90844,90845,90846,90847,90848,90853,90888,91001,91003,91006,91007,91009,91010,91011,91012,91016,
		   91017,91020,91021,91023,91024,91025,91030,91031,91040,91041,91042,91043,91046,91050,91051,91066,91077,91101,91102,91103,91104,91105,91106,91107,
		   91108,91109,91110,91114,91115,91116,91117,91118,91121,91123,91124,91125,91126,91129,91131,91175,91182,91184,91185,91186,91187,91188,91189,91191,
		   91201,91202,91203,91204,91205,91206,91207,91208,91209,91210,91214,91221,91222,91224,91225,91226,91301,91302,91303,91304,91305,91306,91307,91308,
		   91309,91310,91311,91312,91313,91316,91319,91320,91321,91322,91324,91325,91326,91327,91328,91329,91330,91331,91333,91334,91335,91337,91340,91341,
		   91342,91343,91344,91345,91346,91350,91351,91352,91353,91354,91355,91356,91357,91358,91359,91360,91361,91362,91363,91364,91365,91367,91371,91372,
		   91376,91377,91380,91381,91382,91383,91384,91385,91386,91388,91392,91393,91394,91395,91396,91399,91401,91402,91403,91404,91405,91406,91407,91408,
		   91409,91410,91411,91412,91413,91416,91423,91426,91436,91470,91482,91495,91496,91497,91499,91501,91502,91503,91504,91505,91506,91507,91508,91510,
		   91521,91522,91523,91526,91601,91602,91603,91604,91605,91606,91607,91608,91609,91610,91611,91612,91614,91615,91616,91617,91618,91701,91702,91706,
		   91708,91709,91711,91714,91715,91716,91718,91719,91720,91722,91723,91724,91729,91730,91731,91732,91733,91734,91735,91737,91739,91740,91741,91743,
		   91744,91745,91746,91747,91748,91749,91750,91752,91754,91755,91756,91758,91759,91760,91761,91762,91763,91764,91765,91766,91767,91768,91769,91770,
		   91771,91772,91773,91775,91776,91778,91780,91784,91785,91786,91788,91789,91790,91791,91792,91793,91795,91797,91798,91799,91801,91802,91803,91804,
		   91841,91896,91899,91901,91902,91903,91905,91906,91908,91909,91910,91911,91912,91913,91914,91915,91916,91917,91921,91931,91932,91933,91934,91935,
		   91941,91942,91943,91944,91945,91946,91947,91948,91950,91951,91962,91963,91976,91977,91978,91979,91980,91987,91990,92003,92004,92007,92008,92009,
		   92013,92014,92018,92019,92020,92021,92022,92023,92024,92025,92026,92027,92028,92029,92030,92033,92036,92037,92038,92039,92040,92046,92049,92051,
		   92052,92054,92055,92056,92057,92058,92059,92060,92061,92064,92065,92066,92067,92068,92069,92070,92071,92072,92074,92075,92078,92079,92082,92083,
		   92084,92085,92086,92088,92090,92091,92092,92093,92096,92101,92102,92103,92104,92105,92106,92107,92108,92109,92110,92111,92112,92113,92114,92115,
		   92116,92117,92118,92119,92120,92121,92122,92123,92124,92126,92127,92128,92129,92130,92131,92132,92133,92134,92135,92136,92137,92138,92139,92140,
		   92142,92143,92145,92147,92149,92150,92152,92153,92154,92155,92158,92159,92160,92161,92162,92163,92164,92165,92166,92167,92168,92169,92170,92171,
		   92172,92173,92174,92175,92176,92177,92178,92179,92182,92184,92186,92187,92190,92191,92192,92193,92194,92195,92196,92197,92198,92199,92201,92202,
		   92203,92210,92211,92220,92223,92225,92227,92230,92231,92232,92233,92234,92235,92236,92239,92240,92241,92242,92243,92244,92250,92251,92252,92253,
		   92254,92255,92256,92257,92258,92259,92260,92261,92262,92263,92264,92268,92270,92273,92274,92275,92276,92277,92278,92280,92281,92282,92284,92285,
		   92286,92292,92301,92304,92305,92307,92308,92309,92310,92311,92312,92313,92314,92315,92316,92317,92318,92320,92321,92322,92323,92324,92325,92326,
		   92327,92329,92332,92333,92334,92336,92337,92338,92339,92340,92341,92342,92345,92346,92347,92350,92352,92354,92356,92357,92358,92359,92363,92365,
		   92366,92368,92369,92371,92372,92373,92374,92375,92376,92377,92378,92382,92385,92386,92391,92393,92394,92397,92398,92399,92401,92402,92403,92404,
		   92405,92406,92407,92408,92410,92411,92412,92413,92414,92415,92416,92418,92420,92423,92424,92427,92501,92502,92503,92504,92505,92506,92507,92508,
		   92509,92513,92514,92515,92516,92517,92518,92519,92521,92522,92530,92531,92532,92536,92539,92543,92544,92545,92546,92548,92549,92551,92552,92553,
		   92554,92555,92556,92557,92561,92562,92563,92564,92567,92570,92571,92572,92581,92582,92583,92584,92585,92586,92587,92589,92590,92591,92592,92593,
		   92595,92596,92599,92602,92603,92604,92605,92606,92607,92610,92612,92614,92615,92616,92618,92619,92620,92623,92624,92625,92626,92627,92628,92629,
		   92630,92646,92647,92648,92649,92650,92651,92652,92653,92654,92655,92656,92657,92658,92659,92660,92661,92662,92663,92672,92673,92674,92675,92676,
		   92677,92678,92679,92683,92684,92685,92688,92690,92691,92692,92693,92694,92697,92698,92701,92702,92703,92704,92705,92706,92707,92708,92709,92710,
		   92711,92712,92728,92735,92780,92781,92782,92799,92801,92802,92803,92804,92805,92806,92807,92808,92811,92812,92814,92815,92816,92817,92821,92822,
		   92823,92825,92831,92832,92833,92834,92835,92836,92837,92838,92840,92841,92842,92843,92844,92845,92846,92850,92856,92857,92859,92860,92861,92862,
		   92863,92864,92865,92866,92867,92868,92869,92870,92871,92877,92878,92879,92880,92881,92882,92883,92885,92886,92887,92899,93001,93002,93003,93004,
		   93005,93006,93007,93009,93010,93011,93012,93015,93016,93020,93021,93022,93023,93024,93030,93031,93032,93033,93034,93035,93040,93041,93042,93043,
		   93044,93060,93061,93062,93063,93064,93065,93066,93093,93094,93099,93203,93243,93255,93307,93501,93502,93504,93505,93510,93516,93519,93523,93527,
		   93528,93531,93532,93534,93535,93536,93539,93543,93544,93550,93551,93552,93553,93554,93555,93558,93560,93561,93562,93563,93584,93586,93590,93591,
		   93592,93599';
$coverage = explode(',', $stringCoverage);

if(!(in_array($zip, $coverage)))
{
        echo "Zip code didn't match";
        exit;
}


$BMI = calculateBMI($height, $weight);

$message = 'The following person has inquired about a life insurance policy.  Please contact this person.  Do not respond to the email address from which this email was sent.
'."\n"."\n";


$message .= "First Name: " . $name . "\n";
$message .= "Last Name: " . $lastname . "\n";
$message .= "Address: " . $address . "\n";
$message .= "City: " . $city . "\=n";
$message .= "State: " . $st . "\n";
$message .= "Zip Code: " . $zip . "\n";
$message .= "Email Address: " . $emailaddress . "\n";
$message .= "Phone number: " . $homephone . "\n";
$message .= "Date of Birth: " . $dob_month . "-".$dob_day."-".$dob_year."\n";
$message .= "Height: " . $height . "\n";
$message .= "Weight: " . $weight . "\n";
$message .= "Tobacco Usage: " . $tobacco . "\n";
$message .= "Term Length: " . $termlength . "\n";
$message .= "Coverage Amount: " . $coverageamount . "\n";
$message .= "BMI: " . substr((string)$BMI, 0, 5) . "\n";

//REAL LEADS GO HERE
$to = 'john.fountain@prudential.com';

$headers = "From: leads@undergroundelephant.com" . "\r\n";

if(@mail($to, 'Lead from Underground Elephant', $message, $headers)){
        echo 'Success';
}else{
        echo 'Failure';
}
?>